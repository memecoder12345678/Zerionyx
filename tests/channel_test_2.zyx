load "libs.threading"
load "libs.channel"
load "libs.time"

println("--- Producer/Consumer Demo ---")

let messages = channel.new()

defun producer()
    for i = 1 to 5 do
        println("Producer: sending " + to_str(i))
        channel.send(messages, i)
        time.sleep(1)
    done
    println("Producer: finished sending")
done

defun consumer()
    for i = 1 to 5 do
        let msg = channel.recv(messages)
        println("Consumer: received -> " + to_str(msg))
    done
    println("Consumer: finished receiving")
done

let t1 = threading.start(producer)
let t2 = threading.start(consumer)

threading.join(t1)
threading.join(t2)

println("--- Demo Finished ---")
